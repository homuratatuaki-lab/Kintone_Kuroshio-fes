<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>提出状況 一括同期 - 設定</title>
</head>
<body>
  <div id="config-container">
    <p id="config-loading" class="config-loading" style="display:none;">読み込み中…</p>
    <div id="config-error-message" class="config-error" role="alert" style="display:none;"></div>

    <section class="config-card config-mode-card">
      <h2 class="config-mode-title">このアプリの役割</h2>
      <div class="config-mode-radios">
        <label class="radio-label"><input type="radio" name="config-mode" value="parent" id="config-mode-parent" checked> 団体管理</label>
        <label class="radio-label"><input type="radio" name="config-mode" value="contact" id="config-mode-contact"> 連絡先（同期先・表示用）</label>
      </div>
    </section>

    <div id="parent-mode-config">
    <section class="config-card card-step">
      <div class="step-head">
        <span class="step-num">1</span>
        <div>
          <h2>団体管理の紐付け</h2>
          <p class="section-hint">団体1件に対応する項目（レコード番号・団体IDなど）を選びます。</p>
        </div>
      </div>
      <div class="field-block">
        <label for="parent-group-id-field" class="field-label">紐付けキー</label>
        <select id="parent-group-id-field" class="field-input"></select>
      </div>
    </section>

    <section class="config-card card-step">
      <div class="step-head">
        <span class="step-num">2</span>
        <div>
          <h2>連絡先の設定</h2>
          <p class="section-hint">結果を反映するアプリと、団体と同じ値の紐付けキーを選びます。</p>
        </div>
      </div>
      <div class="field-block">
        <label for="contact-app-id" class="field-label">連絡先アプリ</label>
        <select id="contact-app-id" class="field-input"></select>
      </div>
      <div class="field-block">
        <label for="contact-group-id-field" class="field-label">紐付けキー</label>
        <select id="contact-group-id-field" class="field-input"></select>
      </div>
    </section>

    <section class="config-card card-step">
      <div class="step-head">
        <span class="step-num">3</span>
        <div>
          <h2>申請書の指定</h2>
          <p class="section-hint">提出状況を集計する申請書アプリを追加します。</p>
        </div>
      </div>
      <div class="table-wrap">
        <p class="table-scroll-hint">※ 横スクロールで全体を表示</p>
        <table id="child-app-table" class="config-table">
          <thead>
            <tr>
              <th>申請書アプリ</th>
              <th>紐付けキー</th>
              <th>連携モード</th>
              <th>取得する欄（内容取得時）</th>
              <th class="th-flow"><span class="th-arrow">→</span> 団体管理に表示</th>
              <th class="th-flow"><span class="th-arrow">→</span> 連絡先に表示</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="child-app-tbody"></tbody>
        </table>
      </div>
      <p class="section-hint section-flow-hint" style="margin-top:8px;"><span class="flow-arrow">申請書の結果</span> <span class="flow-arrow-symbol">→</span> 団体管理・連絡先の「表示」欄に反映されます。（団体管理に表示した欄はAPIからのみ更新可能）</p>
      <button type="button" id="add-child-row" class="btn btn-add">+ 申請書を追加</button>
    </section>
    </div>

    <div id="contact-mode-config" style="display:none;">
    <section class="config-card card-step">
      <div class="step-head">
        <span class="step-num">1</span>
        <div>
          <h2>フラグ欄の編集制限（APIからのみ更新可）</h2>
          <p class="section-hint">同期で更新される欄を一覧で編集不可にすると、手動変更を防げます。</p>
        </div>
      </div>
      <div class="field-block">
        <label class="field-label">編集不可にする欄（複数選択可）</label>
        <div id="contact-readonly-fields" class="checkbox-list"></div>
      </div>
    </section>
    <section class="config-card card-step">
      <div class="step-head">
        <span class="step-num">2</span>
        <div>
          <h2>一覧の絞り込み</h2>
          <p class="section-hint">フラグの状態（提出済/未提出）で一覧を絞り込む切り替えを表示します。</p>
        </div>
      </div>
      <div class="field-block">
        <label class="checkbox-label"><input type="checkbox" id="contact-listview-filter"> 一覧でフラグによる絞り込みをする</label>
      </div>
      <div class="field-block">
        <label for="contact-listview-default-contact" class="field-label">一覧を開いたときの表示</label>
        <select id="contact-listview-default-contact" class="field-input">
          <option value="all">全て</option>
          <option value="submitted">提出済あり</option>
          <option value="not_submitted">未提出のみ</option>
        </select>
        <p class="section-hint">団体管理の設定と揃えると、同じ絞り込みが一覧に反映されます。</p>
      </div>
      <div class="field-block">
        <label class="field-label">提出物ごとの一覧View</label>
        <p class="section-hint">申請書（提出物）ごとに一覧で切り替えられるViewを追加します。表示名と、提出済/未提出が入る欄を指定してください。</p>
        <div class="table-wrap">
          <table id="contact-view-settings-table" class="config-table">
            <thead>
              <tr>
                <th>表示名</th>
                <th>提出状況の欄（フィールドコード）</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="contact-view-settings-tbody"></tbody>
          </table>
        </div>
        <button type="button" id="add-contact-view-row" class="btn btn-add">+ 提出物を追加</button>
      </div>
    </section>
    </div>

    <div class="actions">
      <button type="button" id="btn-cancel" class="btn btn-ghost">キャンセル</button>
      <button type="button" id="btn-save" class="btn btn-primary btn-save">保存する</button>
    </div>
  </div>
</body>
</html>
